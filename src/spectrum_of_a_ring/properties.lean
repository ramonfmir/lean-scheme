
/-
Who knows how much of this we need.

Lemma 10.16.2. Let R be a ring.

    The spectrum of a ring R is empty if and only if R is the zero ring.
    Every nonzero ring has a maximal ideal.
    Every nonzero ring has a minimal prime ideal.
    Given an ideal IâŠ‚R and a prime ideal IâŠ‚ğ”­ there exists a prime IâŠ‚ğ”®âŠ‚ğ”­ such that ğ”® is minimal over I.
  (5)  If TâŠ‚R, and if (T) is the ideal generated by T in R, then V((T))=V(T).
    If I is an ideal and Iâˆš is its radical, see basic notion (27), then V(I)=V(Iâˆš).
    Given an ideal I of R we have Iâˆš=â‹‚IâŠ‚ğ”­ğ”­.
  (8)  If I is an ideal then V(I)=âˆ… if and only if I is the unit ideal.
    If I, J are ideals of R then V(I)âˆªV(J)=V(Iâˆ©J).
    If (Ia)aâˆˆA is a set of ideals of R then âˆ©aâˆˆAV(Ia)=V(âˆªaâˆˆAIa).
    If fâˆˆR, then D(f)â¨¿V(f)=Spec(R).
    If fâˆˆR then D(f)=âˆ… if and only if f is nilpotent.
    If f=ufâ€² for some unit uâˆˆR, then D(f)=D(fâ€²).
    If IâŠ‚R is an ideal, and ğ”­ is a prime of R with ğ”­âˆ‰V(I), then there exists an fâˆˆR such that ğ”­âˆˆD(f), and D(f)âˆ©V(I)=âˆ….
  (15)  If f,gâˆˆR, then D(fg)=D(f)âˆ©D(g).
  (16)  If fiâˆˆR for iâˆˆI, then â‹ƒiâˆˆID(fi) is the complement of V({fi}iâˆˆI) in Spec(R).
    If fâˆˆR and D(f)=Spec(R), then f is a unit. 

Proof. We address each part in the corresponding item below.

    This is a direct consequence of (2) or (3).
    Let ğ”„ be the set of all proper ideals of R. This set is ordered by inclusion and is non-empty, since (0)âˆˆğ”„ is a proper ideal. Let A be a totally ordered subset of ğ”„. Then â‹ƒIâˆˆAI is in fact an ideal. Since 1 âˆ‰I for all IâˆˆA, the union does not contain 1 and thus is proper. Hence â‹ƒIâˆˆAI is in ğ”„ and is an upper bound for the set A. Thus by Zorn's lemma ğ”„ has a maximal element, which is the sought-after maximal ideal.
    Since R is nonzero, it contains a maximal ideal which is a prime ideal. Thus the set ğ”„ of all prime ideals of R is nonempty. ğ”„ is ordered by reverse-inclusion. Let A be a totally ordered subset of ğ”„. It's pretty clear that J=â‹‚IâˆˆAI is in fact an ideal. Not so clear, however, is that it is prime. Let xyâˆˆJ. Then xyâˆˆI for all IâˆˆA. Now let B={IâˆˆA|yâˆˆI}. Let K=â‹‚IâˆˆBI. Since A is totally ordered, either K=J (and we're done, since then yâˆˆJ) or KâŠƒJ and for all IâˆˆA such that I is properly contained in K, we have yâˆ‰I. But that means that for all those I,xâˆˆI, since they are prime. Hence xâˆˆJ. In either case, J is prime as desired. Hence by Zorn's lemma we get a maximal element which in this case is a minimal prime ideal.
    This is the same exact argument as (3) except you only consider prime ideals contained in ğ”­ and containing I.
    (T) is the smallest ideal containing T. Hence if TâŠ‚I, some ideal, then (T)âŠ‚I as well. Hence if IâˆˆV(T), then IâˆˆV((T)) as well. The other inclusion is obvious.
    Since IâŠ‚Iâˆš,V(Iâˆš)âŠ‚V(I). Now let ğ”­âˆˆV(I). Let xâˆˆIâˆš. Then xnâˆˆI for some n. Hence xnâˆˆğ”­. But since ğ”­ is prime, a boring induction argument gets you that xâˆˆğ”­. Hence IâˆšâŠ‚ğ”­ and ğ”­âˆˆV(Iâˆš).
    Let fâˆˆRâˆ–Iâˆš. Then fnâˆ‰I for all n. Hence S={1,f,f2,â€¦} is a multiplicative subset, not containing 0. Take a prime ideal ğ”­Â¯âŠ‚Sâˆ’1R containing Sâˆ’1I. Then the pull-back ğ”­ in R of ğ”­Â¯ is a prime ideal containing I that does not intersect S. This shows that â‹‚IâŠ‚ğ”­ğ”­âŠ‚Iâˆš. Now if aâˆˆIâˆš, then anâˆˆI for some n. Hence if IâŠ‚ğ”­, then anâˆˆğ”­. But since ğ”­ is prime, we have aâˆˆğ”­. Thus the equality is shown.
    I is not the unit ideal if and only if I is contained in some maximal ideal (to see this, apply (2) to the ring R/I) which is therefore prime.
    If ğ”­âˆˆV(I)âˆªV(J), then IâŠ‚ğ”­ or JâŠ‚ğ”­ which means that Iâˆ©JâŠ‚ğ”­. Now if Iâˆ©JâŠ‚ğ”­, then IJâŠ‚ğ”­ and hence either I of J is in ğ”­, since ğ”­ is prime.
    ğ”­âˆˆâ‹‚aâˆˆAV(Ia)â‡”IaâŠ‚ğ”­,âˆ€aâˆˆAâ‡”ğ”­âˆˆV(âˆªaâˆˆAIa)
    If ğ”­ is a prime ideal and fâˆˆR, then either fâˆˆğ”­ or fâˆ‰ğ”­ (strictly) which is what the disjoint union says.
    If aâˆˆR is nilpotent, then an=0 for some n. Hence anâˆˆğ”­ for any prime ideal. Thus aâˆˆğ”­ as can be shown by induction and D(f)=âˆ…. Now, as shown in (7), if aâˆˆR is not nilpotent, then there is a prime ideal that does not contain it.
    fâˆˆğ”­â‡”ufâˆˆğ”­, since u is invertible.
    If ğ”­âˆ‰V(I), then âˆƒfâˆˆIâˆ–ğ”­. Then fâˆ‰ğ”­ so ğ”­âˆˆD(f). Also if ğ”®âˆˆD(f), then fâˆ‰ğ”® and thus I is not contained in ğ”®. Thus D(f)âˆ©V(I)=âˆ….
    If fgâˆˆğ”­, then fâˆˆğ”­ or gâˆˆğ”­. Hence if fâˆ‰ğ”­ and gâˆ‰ğ”­, then fgâˆ‰ğ”­. Since ğ”­ is an ideal, if fgâˆ‰ğ”­, then fâˆ‰ğ”­ and gâˆ‰ğ”­.
    ğ”­âˆˆâ‹ƒiâˆˆID(fi)â‡”âˆƒiâˆˆI,fiâˆ‰ğ”­â‡”ğ”­âˆˆSpec(R)âˆ–V({fi}iâˆˆI)
    If D(f)=Spec(R), then V(f)=âˆ… and hence fR=R, so f is a unit. 


\begin{lemma}
\label{lemma-Zariski-topology}
Let $R$ be a ring.
\begin{enumerate}
\item The spectrum of a ring $R$ is empty if and only if $R$
is the zero ring.
\item Every nonzero ring has a maximal ideal.
\item Every nonzero ring has a minimal prime ideal.
\item Given an ideal $I \subset R$ and a prime ideal
$I \subset \mathfrak p$ there exists a prime
$I \subset \mathfrak q \subset \mathfrak p$ such
that $\mathfrak q$ is minimal over $I$.
\item If $T \subset R$, and if $(T)$ is the ideal generated by
$T$ in $R$, then $V((T)) = V(T)$.
\item If $I$ is an ideal and $\sqrt{I}$ is its radical,
see basic notion (\ref{item-radical-ideal}), then $V(I) = V(\sqrt{I})$.
\item Given an ideal $I$ of $R$ we have $\sqrt{I} =
\bigcap_{I \subset \mathfrak p} \mathfrak p$.
\item If $I$ is an ideal then $V(I) = \emptyset$ if and only
if $I$ is the unit ideal.
\item If $I$, $J$ are ideals of $R$ then $V(I) \cup V(J) =
V(I \cap J)$.
\item If $(I_a)_{a\in A}$ is a set of ideals of $R$ then
$\cap_{a\in A} V(I_a) = V(\cup_{a\in A} I_a)$.
\item If $f \in R$, then $D(f) \amalg V(f) = \Spec(R)$.
\item If $f \in R$ then $D(f) = \emptyset$ if and only if $f$
is nilpotent.
\item If $f = u f'$ for some unit $u \in R$, then $D(f) = D(f')$.
\item If $I \subset R$ is an ideal, and $\mathfrak p$ is a prime of
$R$ with $\mathfrak p \not\in V(I)$, then there exists an $f \in R$
such that $\mathfrak p \in D(f)$, and $D(f) \cap V(I) = \emptyset$.
\item If $f, g \in R$, then $D(fg) = D(f) \cap D(g)$.
\item If $f_i \in R$ for $i \in I$, then
$\bigcup_{i\in I} D(f_i)$ is the complement of $V(\{f_i \}_{i\in I})$
in $\Spec(R)$.
\item If $f \in R$ and $D(f) = \Spec(R)$, then $f$ is a unit.
\end{enumerate}
\end{lemma}

\begin{proof}
We address each part in the corresponding item below.
\begin{enumerate}
\item This is a direct consequence of (2) or (3).
\item Let $\mathfrak{A}$ be the set of all proper ideals of $R$. This set is
ordered by inclusion and is non-empty, since $(0) \in \mathfrak{A}$ is a proper
ideal. Let $A$ be a totally ordered subset of $\mathfrak A$.
Then $\bigcup_{I \in A} I$ is in
fact an ideal. Since 1 $\notin I$ for all $I \in A$, the union does not contain
1 and thus is proper. Hence $\bigcup_{I \in A} I$ is in $\mathfrak{A}$ and is
an upper bound for the set $A$. Thus by Zorn's lemma $\mathfrak{A}$ has a
maximal element, which is the sought-after maximal ideal.
\item Since $R$ is nonzero, it contains a maximal ideal which is a prime ideal.
Thus the set $\mathfrak{A}$ of all prime ideals of $R$ is nonempty.
$\mathfrak{A}$ is ordered by reverse-inclusion. Let $A$ be a totally ordered
subset of $\mathfrak{A}$. It's pretty clear that $J = \bigcap_{I \in A} I$ is
in fact an ideal. Not so clear, however, is that it is prime. Let $xy \in J$.
Then $xy \in I$ for all $I \in A$. Now let $B = \{I \in A | y \in I\}$. Let $K
= \bigcap_{I \in B} I$. Since $A$ is totally ordered, either $K = J$ (and we're
done, since then $y \in J$) or $K \supset J$ and for all $I \in A$ such that
$I$ is properly contained in $K$, we have $y \notin I$. But that means that for
all those $I, x \in I$, since they are prime. Hence $x \in J$. In either case,
$J$ is prime as desired. Hence by Zorn's lemma we get a maximal element which
in this case is a minimal prime ideal.
\item This is the same exact argument as (3) except you only consider prime
ideals contained in $\mathfrak{p}$ and containing $I$.
\item $(T)$ is the smallest ideal containing $T$. Hence if $T \subset I$, some
ideal, then $(T) \subset I$ as well. Hence if $I \in V(T)$, then $I \in V((T))$
as well. The other inclusion is obvious.
\item Since $I \subset \sqrt{I}, V(\sqrt{I}) \subset V(I)$. Now let
$\mathfrak{p} \in V(I)$. Let $x \in \sqrt{I}$. Then $x^n \in I$ for some $n$.
Hence $x^n \in \mathfrak{p}$. But since $\mathfrak{p}$ is prime, a boring
induction argument gets you that $x \in \mathfrak{p}$. Hence $\sqrt{I} \subset
\mathfrak{p}$ and $\mathfrak{p} \in V(\sqrt{I})$.
\item Let $f \in R \setminus \sqrt{I}$. Then $f^n \notin I$ for all $n$. Hence
$S = \{1, f, f^2, \ldots\}$ is a multiplicative subset, not containing $0$.
Take a
prime ideal $\bar{\mathfrak{p}} \subset S^{-1}R$ containing $S^{-1}I$. Then the
pull-back $\mathfrak{p}$ in $R$ of $\bar{\mathfrak{p}}$ is a prime ideal
containing $I$ that does not intersect $S$. This shows that $\bigcap_{I \subset
\mathfrak p} \mathfrak p \subset \sqrt{I}$. Now if $a \in \sqrt{I}$, then $a^n
\in I$ for some $n$. Hence if $I \subset \mathfrak{p}$, then $a^n \in
\mathfrak{p}$. But since $\mathfrak{p}$ is prime, we have $a \in \mathfrak{p}$.
Thus the equality is shown.
\item $I$ is not the unit ideal if and only if $I$
is contained in some maximal ideal (to
see this, apply (2) to the ring $R/I$) which is therefore prime.
\item If $\mathfrak{p} \in V(I) \cup V(J)$, then $I \subset \mathfrak{p}$ or $J
\subset \mathfrak{p}$ which means that $I \cap J \subset \mathfrak{p}$. Now if
$I \cap J \subset \mathfrak{p}$, then $IJ \subset \mathfrak{p}$ and hence
either $I$ of $J$ is in $\mathfrak{p}$, since $\mathfrak{p}$ is prime.
\item $\mathfrak{p} \in \bigcap_{a \in A} V(I_a) \Leftrightarrow I_a \subset
\mathfrak{p}, \forall a \in A \Leftrightarrow \mathfrak{p} \in V(\cup_{a\in A}
I_a)$
\item If $\mathfrak{p}$ is a prime ideal and $f \in R$, then either $f \in
\mathfrak{p}$ or $f \notin \mathfrak{p}$ (strictly) which is what the disjoint
union says.
\item If $a \in R$ is nilpotent, then $a^n = 0$ for some $n$. Hence $a^n \in
\mathfrak{p}$ for any prime ideal. Thus $a \in \mathfrak{p}$ as can be shown by
induction and $D(f) = \emptyset$. Now, as shown in (7), if $a \in R$ is not
nilpotent, then there is a prime ideal that does not contain it.
\item $f \in \mathfrak{p} \Leftrightarrow uf \in \mathfrak{p}$, since $u$ is
invertible.
\item If $\mathfrak{p} \notin V(I)$, then $\exists f \in I \setminus
\mathfrak{p}$. Then $f \notin \mathfrak{p}$ so $\mathfrak{p} \in D(f)$. Also if
$\mathfrak{q} \in D(f)$, then $f \notin \mathfrak{q}$ and thus $I$ is not
contained in $\mathfrak{q}$. Thus $D(f) \cap V(I) = \emptyset$.
\item If $fg \in \mathfrak{p}$, then $f \in \mathfrak{p}$ or $g \in
\mathfrak{p}$. Hence if $f \notin \mathfrak{p}$ and $g \notin \mathfrak{p}$,
then $fg \notin \mathfrak{p}$. Since $\mathfrak{p}$ is an ideal, if $fg \notin
\mathfrak{p}$, then $f \notin \mathfrak{p}$ and $g \notin \mathfrak{p}$.
\item $\mathfrak{p} \in \bigcup_{i \in I} D(f_i) \Leftrightarrow \exists i \in
I, f_i \notin \mathfrak{p} \Leftrightarrow \mathfrak{p} \in \Spec(R)
\setminus V(\{f_i\}_{i \in I})$
\item If $D(f) = \Spec(R)$, then $V(f) = \emptyset$ and
hence $fR = R$, so $f$ is a unit.
\end{enumerate}
\end{proof}
-/

import Kenny_comm_alg.maximal_ideal Kenny_comm_alg.minimal_prime_ideal
import Kenny_comm_alg.avoid_powers Kenny_comm_alg.Zariski Kenny_comm_alg.ideal_operations

noncomputable theory
local attribute [instance] classical.prop_decidable

--local infix ^ := monoid.pow

universe u

namespace tag00E0

variables (R : Type u) [comm_ring R]

lemma lemma01 : (X R â†’ false) â†” subsingleton R :=
âŸ¨Î» h, have h1 : (0:R) = 1,
   from classical.by_contradiction
     (Î» hzo, h âŸ¨is_ideal.find_maximal_ideal.of_zero_ne_one hzo,
        (is_ideal.find_maximal_ideal.of_zero_ne_one.is_maximal_ideal hzo).to_is_prime_idealâŸ©),
   âŸ¨Î» x y, calc x = x * 0 : by rw [h1, mul_one]
              ... = y * 0 : by simp
              ... = y : by rw [h1, mul_one]âŸ©,
 Î» h x, @@is_proper_ideal.ne_univ _ x.1 x.2.1 $
   set.eq_univ_of_forall $ Î» z, calc
           z = z * 1 : eq.symm $ mul_one z
         ... = z * 0 : congr_arg _ (@subsingleton.elim R h 1 0)
         ... = 0 : mul_zero z
         ... âˆˆ x.val : @is_ideal.zero R _ x.val x.2.1.1âŸ©

lemma lemma02 : (0:R) â‰  1 â†’ âˆƒ S:set R, is_maximal_ideal S :=
Î» hzo, âŸ¨is_ideal.find_maximal_ideal.of_zero_ne_one hzo,
  is_ideal.find_maximal_ideal.of_zero_ne_one.is_maximal_ideal hzoâŸ©

lemma lemma03 : (0:R) â‰  1 â†’ âˆƒ S:set R, is_prime_ideal S âˆ§ âˆ€ T, is_prime_ideal T â†’ T âŠ† S â†’ T = S :=
Î» hzo, let M := is_ideal.find_maximal_ideal.of_zero_ne_one hzo in
have hm : is_maximal_ideal M := is_ideal.find_maximal_ideal.of_zero_ne_one.is_maximal_ideal hzo,
let S := @is_ideal.find_minimal_prime_ideal' R _ {0} _ M hm.to_is_prime_ideal
  (Î» z hz, by simp at hz; rw hz; exact @is_ideal.zero R _ _ hm.1.1) in
have h1 : is_prime_ideal S := @is_ideal.find_minimal_prime_ideal'.is_prime_ideal R _ {0} _ M hm.to_is_prime_ideal
  (Î» z hz, by simp at hz; rw hz; exact @is_ideal.zero R _ _ hm.1.1),
have h2 : âˆ€ T, is_prime_ideal T â†’ {(0:R)} âŠ† T â†’ T âŠ† S â†’ T = S := @is_ideal.find_minimal_prime_ideal'.minimal R _ {0} _ M hm.to_is_prime_ideal
  (Î» z hz, by simp at hz; rw hz; exact @is_ideal.zero R _ _ hm.1.1),
âŸ¨S, h1, Î» T ht hts, h2 T ht (Î» z hz, by simp at hz; rw hz; exact ht.1.1.1.1) htsâŸ©

lemma lemma04 (I P : set R) [is_ideal I] [is_prime_ideal P] (hip : I âŠ† P) :
  âˆƒ Q:set R, is_prime_ideal Q âˆ§ I âŠ† Q âˆ§ Q âŠ† P âˆ§ âˆ€ S, is_prime_ideal S â†’ I âŠ† S â†’ S âŠ† Q â†’ S = Q :=
let Q := is_ideal.find_minimal_prime_ideal I P hip in
have h1 : is_prime_ideal Q := is_ideal.find_minimal_prime_ideal.is_prime_ideal I P hip,
have h2 : I âŠ† Q := is_ideal.find_minimal_prime_ideal.ideal_contains I P hip,
have h3 : Q âŠ† P := is_ideal.find_minimal_prime_ideal.contains_prime I P hip,
have h4 : âˆ€ S, is_prime_ideal S â†’ I âŠ† S â†’ S âŠ† Q â†’ S = Q,
  from is_ideal.find_minimal_prime_ideal.minimal I P hip,
âŸ¨Q, h1, h2, h3, h4âŸ©

lemma lemma05 (T : set R) : Spec.V (span T) = Spec.V T :=
set.ext $ Î» x,
âŸ¨Î» hx z hz, hx $ subset_span hz,
 Î» hx z hz, span_minimal x.2.1.1.1 hx hzâŸ©

lemma lemma06 (I : set R) [is_ideal I] : Spec.V I = Spec.V (is_ideal.radical I) :=
set.ext $ Î» x,
âŸ¨Î» hx z âŸ¨n, hzâŸ©, @@is_prime_ideal.mem_of_pow_mem _ x.2 $ hx hz,
 Î» hx z hz, hx $ is_ideal.subset_radical I hzâŸ©

lemma lemma07 (I : set R) [is_ideal I] : is_ideal.radical I = â‹‚â‚€ {x | is_prime_ideal x âˆ§ I âŠ† x} :=
set.ext $ Î» f,
âŸ¨Î» âŸ¨n, hfâŸ© x âŸ¨hx, hixâŸ©, @@is_prime_ideal.mem_of_pow_mem _ hx $ hix hf,
 Î» hf, classical.by_contradiction $ Î» hnf,
   have h1 : âˆ€ n : â„•, f^n âˆ‰ I,
     from Î» n, nat.rec_on n
       (Î» hfz, hnf âŸ¨0, is_ideal.mul_left hfzâŸ©)
       (Î» n _ hfni, hnf âŸ¨n, hfniâŸ©),
   let P := is_ideal.avoid_powers f I h1 in
   have h2 : is_prime_ideal P,
     from is_ideal.avoid_powers.is_prime_ideal f I h1,
   have h3 : I âŠ† P,
     from is_ideal.avoid_powers.contains f I h1,
   have h4 : âˆ€ n, f^n âˆ‰ P,
     from is_ideal.avoid_powers.avoid_powers f I h1,
   h4 1 $ by simpa using hf P âŸ¨h2, h3âŸ©âŸ©

lemma lemma08 (I : set R) [is_ideal I] : Spec.V I = âˆ… â†” I = set.univ :=
âŸ¨Î» h, set.eq_univ_of_forall $ classical.by_contradiction $ Î» hn,
   let âŸ¨f, hfâŸ© := not_forall.1 hn in
   have h1 : is_proper_ideal I,
     from âŸ¨Î» hi, by rw set.eq_univ_iff_forall at hi; ccâŸ©,
   suffices âˆƒ x, x âˆˆ Spec.V I,
     by rw [set.eq_empty_iff_forall_not_mem] at h; cases this with x hx; exact h x hx,
   âŸ¨âŸ¨@is_ideal.find_maximal_ideal R _ I h1,
    (@is_ideal.find_maximal_ideal.is_maximal_ideal R _ I h1).to_is_prime_idealâŸ©,
    @is_ideal.find_maximal_ideal.contains R _ I h1âŸ©,
 Î» h, set.eq_empty_of_subset_empty $ Î» z hz,
   @is_proper_ideal.ne_univ R _ z.1 z.2.1 $
   set.eq_univ_of_univ_subset $ h â–¸ hzâŸ©

lemma lemma09 (I J : set R) [is_ideal I] [is_ideal J] : Spec.V I âˆª Spec.V J = Spec.V (I âˆ© J) :=
have h1 : generate I = I,
  from set.eq_of_subset_of_subset
    (Î» z hz, hz I $ set.subset.refl I)
    (subset_generate I),
have h2 : generate J = J,
  from set.eq_of_subset_of_subset
    (Î» z hz, hz J $ set.subset.refl J)
    (subset_generate J),
have h3 : Spec.V (generate I âˆ© generate J) = Spec.V I âˆª Spec.V J,
  from set.ext (Zariski._match_6 R _ _ I rfl J rfl), --hack level â‰¥ 9000
by rw [â† h3, h1, h2]

-- we don't even need the fact that they are ideals
lemma lemma10 (SS : set (set R)) : â‹‚â‚€ (Spec.V '' SS) = Spec.V â‹ƒâ‚€ SS :=
set.ext $ Î» x,
âŸ¨Î» hx f âŸ¨I, his, hfiâŸ©, hx _ âŸ¨I, his, rflâŸ© hfi,
 Î» hx S âŸ¨I, his, hiâŸ©, hi â–¸ Î» f hfi, hx âŸ¨I, his, hfiâŸ©âŸ©

lemma lemma11a (f : R) : Spec.D' f âˆª Spec.V' f = set.univ :=
by finish [set.ext_iff]

lemma lemma11b (f : R) : Spec.D' f âˆ© Spec.V' f = âˆ… :=
by finish [set.ext_iff]

lemma lemma12 (f : R) : Spec.D' f = âˆ… â†” âˆƒ n : â„•, f^n = 0 :=
âŸ¨Î» h, classical.by_contradiction $ Î» hf,
   have h1 : âˆ€ (n : â„•), f ^ n âˆ‰ ({0} : set R),
     from Î» n hfn, not_exists.1 hf n $ set.mem_singleton_iff.1 hfn,
   let x := is_ideal.avoid_powers f {0} h1 in
   have h2 : is_prime_ideal x,
     from is_ideal.avoid_powers.is_prime_ideal f {0} h1,
   have h3 : âˆ€ n, f^n âˆ‰ x,
     from is_ideal.avoid_powers.avoid_powers f {0} h1,
   have h4 : f âˆ‰ x,
     by simpa using h3 1,
   set.eq_empty_iff_forall_not_mem.1 h âŸ¨x, h2âŸ© h4,
 Î» âŸ¨n, hfnâŸ©, set.eq_empty_of_subset_empty $
   Î» x hx, hx $ @@is_prime_ideal.mem_of_pow_mem _ x.2
   (set.mem_of_eq_of_mem hfn $
    @@is_ideal.zero _ x.1 x.2.1.1)âŸ©

-- slightly modified
lemma lemma13 (f g u v : R) (hf : f = g * u) (hg : g = f * v)
  (huv : u * v = 1) : Spec.D' f = Spec.D' g :=
set.ext $ Î» x, not_iff_not.2
âŸ¨assume hfx : f âˆˆ x.val,
   have h1 : g * u âˆˆ x.val,
     from set.mem_of_eq_of_mem hf.symm hfx,
   or.cases_on
     (@@is_prime_ideal.mem_or_mem_of_mul_mem _ x.2 h1)
     id (Î» hu, false.elim $
       @@is_proper_ideal.not_mem_of_mul_right_one _ x.2.1 huv hu),
 assume hgx : g âˆˆ x.val,
   have h1 : f * v âˆˆ x.val,
     from set.mem_of_eq_of_mem hg.symm hgx,
   or.cases_on
     (@@is_prime_ideal.mem_or_mem_of_mul_mem _ x.2 h1)
     id (Î» hv, false.elim $
       @@is_proper_ideal.not_mem_of_mul_left_one _ x.2.1 huv hv),âŸ©

-- people need to stop abstracting things by existentials
lemma lemma14 (f : R) (I : set R) [is_ideal I] (hfi : f âˆˆ I) :
  Spec.D' f âˆ© Spec.V I = âˆ… :=
set.eq_empty_of_subset_empty $ Î» z âŸ¨hzf, hziâŸ©, hzf $ hzi hfi

lemma lemma15 (f g : R) : Spec.D' (f * g) = Spec.D' f âˆ© Spec.D' g :=
set.ext $ Î» x,
âŸ¨Î» hx, âŸ¨Î» hfx, hx $ @@is_ideal.mul_right _ x.2.1.1 hfx,
   Î» hgx, hx $ @@is_ideal.mul_left _ x.2.1.1 hgxâŸ©,
 Î» âŸ¨hfx, hgxâŸ© hx, or.cases_on
   (@@is_prime_ideal.mem_or_mem_of_mul_mem _ x.2 hx)
   hfx hgxâŸ©

lemma lemma16 (F : set R) : â‹ƒâ‚€ ((Spec.D') '' F) = -Spec.V F :=
set.ext $ Î» x,
âŸ¨Î» âŸ¨S, âŸ¨f, hff, hfsâŸ©, hxâŸ© h,
   have h1 : x âˆˆ Spec.D' f, by rwa â† hfs at hx,
   h1 $ h hff,
 Î» hx, let âŸ¨f, hfâŸ© := not_forall.1 hx in
   let âŸ¨hff, hfxâŸ© := not_imp.1 hf in
   âŸ¨_, âŸ¨f, hff, rflâŸ©, hfxâŸ©âŸ©

lemma lemma17 (f : R) (hf : Spec.D' f = set.univ) : âˆƒ g, f * g = 1 :=
have h1 : Spec.V' f = âˆ…,
  from set.eq_empty_of_subset_empty $
    Î» x hx, by rw [set.eq_univ_iff_forall] at hf; specialize hf x; exact hf hx,
have h2 : Spec.V {f} = Spec.V' f,
  by simp [Spec.V, Spec.V'],
have h3 : _,
  from @lemma05 R _ {f},
have h4 : _,
  from @lemma08 R _ (span {f}) is_ideal_span,
have h5 : _,
  from (set.eq_univ_iff_forall.1 $ h4.1 $ h3.trans $ h2.trans h1) 1,
begin
  rw span_singleton at h5,
  cases h5 with g hg,
  existsi g,
  rw mul_comm,
  exact hg
end

-- corollary of 14

lemma cor_to_14 (T : set R) (U : set (X R)) (HT : Spec.V T = -U) (P : X R) (HPU : P âˆˆ U) :
  âˆƒ h : R, P âˆˆ Spec.D' h âˆ§ Spec.D' h âŠ† U :=
have h1 : P âˆ‰ Spec.V T, by rw HT; simp [HPU],
let âŸ¨h, h2, h3âŸ© := set.not_subset.1 h1 in
âŸ¨h, h3, Î» f hf, have h3 : f âˆ‰ Spec.V T, from Î» h4, hf $ h4 h2, by rw HT at h3; simpa using h3âŸ©

end tag00E0